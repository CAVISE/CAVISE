Uniform Artery build
====================

Для сборки Artery (установки зависимостей, конфигурации и компиляции) проекта, ранее
использовалась комбинация *configure.sh* и *build.py*, где *configure.sh* устанавливал и конфигурировал
среду, а *build.py* собирал исходный код. Теперь как альтернатива этому тулчейну используется один *build.py*.

Скрипт расположен в ``tools/build.py`` в репозитории Artery. Для получения актуальных 
команд можно использовать ``./tools/build.py --help``.

Общий пайплайн выглядит следующим образом:

- clear (--clear, очистка директории сборки, с ``--force``  также удалит зависимости)
- install (--install, установка зависимостей)
- configure (--configure, конфигурация сборки)
- build (--build, сборка)

.. caution:: Переменные среды

    При локальной сборке Artery не забывайте проставлять переменные среды из общей
    конфигурации *configure.sh*, например:

    .. code-block:: bash

        source configure.sh
        cd artery  

Clear
-----

Скрипт поддерживает автоматическую очистку артефактов сборки. В базовом режиме
очищается только сборка Artery, зависимости остаются. С ``--force`` скрипт удалит
всю директорию полностью.

Install
-------

Установка зависимостей скриптом аналогична *configure.sh*, для локальной установки Conan
используется флаг ``--local-conan``. Если он не установлен, то конфигурацию Conan нужно выполнять вручную.

Configure & build
-----------------

Конфигурация и сборка Artery в парадигме CMake. Поддерживает две конфигурации: *Debug* и *Release*.

Примеры
-------

Конфигурация и сборка в двух конфигурациях, без установки зависимостей и очистки директории:

.. code-block:: bash

    ./tools/build.py -cb --config Debug --config Release

Полный пайплайн по установке, конфигурации и сборке в *Debug*:

.. code-block:: bash

    ./tools/build.py -icb --config Debug --local-conan

Полная очистка артефактов сборки:

.. code-block:: bash

    ./tools/build.py --clear --force